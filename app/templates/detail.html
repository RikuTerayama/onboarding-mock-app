{% extends "layout.html" %}
{% block content %}
  {% set current_lang = lang|default("en") %}
  <div class="card">
    <div class="row">
      <div class="col">
        <h2 style="margin:0;">{{ t("detail_onboarding", current_lang) }}</h2>
        <div class="muted small">{{ t("detail_id", current_lang) }}: {{ onboarding.id }}</div>
      </div>
      <div class="col" style="text-align:right;">
        <span class="badge">{{ onboarding.status }}</span>
      </div>
    </div>

    <div class="row" style="margin-top:10px;">
      <div class="col">
        <div><strong>{{ t("detail_employee", current_lang) }}:</strong> {{ onboarding.employee_name }}</div>
        <div><strong>{{ t("detail_manager", current_lang) }}:</strong> {{ onboarding.manager_name }}</div>
      </div>
      <div class="col">
        <div><strong>{{ t("detail_role_grade", current_lang) }}:</strong> {{ onboarding.role }}/{{ onboarding.grade }}</div>
        <div><strong>{{ t("detail_start", current_lang) }}:</strong> {{ onboarding.start_date }}</div>
        <div class="muted small">{{ t("detail_template_used", current_lang) }}: {{ template_used }}</div>
      </div>
    </div>
  </div>

  {% if onboarding.status == "PENDING" %}
    <div class="card">
      <h3 style="margin-top:0;">{{ t("detail_approval_title", current_lang) }}</h3>
      <div class="muted">{{ t("detail_approval_desc", current_lang) }}</div>
      <div style="margin-top:10px;">
        <form method="post" action="/onboarding/{{ onboarding.id }}/approve" style="display:inline;">
          <button class="btn btn-primary" type="submit">{{ t("detail_approve", current_lang) }}</button>
        </form>
        <a class="btn btn-danger" href="/onboarding/{{ onboarding.id }}/reject">{{ t("detail_reject", current_lang) }}</a>
      </div>
    </div>
  {% elif onboarding.status == "REJECTED" %}
    <div class="card">
      <h3 style="margin-top:0;">{{ t("detail_rejected", current_lang) }}</h3>
      <div class="muted">{{ t("detail_reason", current_lang) }}: {{ onboarding.rejection_reason or "-" }}</div>
    </div>
  {% endif %}

  {% if onboarding.status == "APPROVED" %}
    <div class="row">
      <div class="col card dm">
        <h3 style="margin-top:0;">{{ t("detail_dm_employee", current_lang) }}</h3>
        <div class="muted small">{{ t("detail_to", current_lang) }}: {{ onboarding.employee_name }}</div>
        <hr style="border:none; border-top:1px solid #eee;"/>
        <p><strong>{{ t("detail_welcome", current_lang) }}</strong> {{ t("detail_welcome_desc", current_lang) }}</p>

        <h4>{{ t("detail_todo", current_lang) }}</h4>
        <ul>
          {% for task in tasks if task.owner == onboarding.employee_name %}
            <li><strong>{{ task.title }}</strong> — {{ task.description }} <span class="muted small">({{ t("detail_due", current_lang) }} {{ task.due_date }})</span></li>
          {% endfor %}
        </ul>

        <h4>30/60/90</h4>
        <ul>
          <li><strong>{{ t("detail_day_30", current_lang) }}:</strong> {{ plan.employee.day30 }}</li>
          <li><strong>{{ t("detail_day_60", current_lang) }}:</strong> {{ plan.employee.day60 }}</li>
          <li><strong>{{ t("detail_day_90", current_lang) }}:</strong> {{ plan.employee.day90 }}</li>
        </ul>

        <div class="muted small">{{ t("detail_note_employee", current_lang) }}</div>
      </div>

      <div class="col card dm">
        <h3 style="margin-top:0;">{{ t("detail_dm_manager", current_lang) }}</h3>
        <div class="muted small">{{ t("detail_to", current_lang) }}: {{ onboarding.manager_name }}</div>
        <hr style="border:none; border-top:1px solid #eee;"/>
        <p><strong>{{ t("detail_approved", current_lang) }}</strong> {{ t("detail_approved_desc", current_lang) }}</p>

        <h4>{{ t("detail_manager_todo", current_lang) }}</h4>
        <ul>
          {% for task in tasks if task.owner == onboarding.manager_name %}
            <li><strong>{{ task.title }}</strong> — {{ task.description }} <span class="muted small">({{ t("detail_due", current_lang) }} {{ task.due_date }})</span></li>
          {% endfor %}
        </ul>

        <h4>30/60/90 ({{ t("detail_manager", current_lang) }} view)</h4>
        <ul>
          <li><strong>{{ t("detail_day_30", current_lang) }}:</strong> {{ plan.manager.day30 }}</li>
          <li><strong>{{ t("detail_day_60", current_lang) }}:</strong> {{ plan.manager.day60 }}</li>
          <li><strong>{{ t("detail_day_90", current_lang) }}:</strong> {{ plan.manager.day90 }}</li>
        </ul>

        <div class="muted small">{{ t("detail_note_manager", current_lang) }}</div>
      </div>
    </div>
  {% endif %}

  <div class="card">
    <h3 style="margin-top:0;">{{ t("detail_tasks_storage", current_lang) }}</h3>
    {% if tasks|length == 0 %}
      <div class="muted">{{ t("detail_no_tasks", current_lang) }}</div>
    {% else %}
      <table>
        <thead><tr><th>{{ t("detail_owner", current_lang) }}</th><th>{{ t("detail_task", current_lang) }}</th><th>{{ t("detail_due", current_lang) }}</th><th>{{ t("detail_done", current_lang) }}</th></tr></thead>
        <tbody>
          {% for task in tasks %}
          <tr>
            <td>{{ task.owner }}</td>
            <td><strong>{{ task.title }}</strong><div class="muted small">{{ task.description }}</div></td>
            <td>{{ task.due_date }}</td>
            <td>
              <form method="post" action="/tasks/{{ task.id }}/toggle" style="margin:0;">
                <input type="hidden" name="redirect_to" value="/onboarding/{{ onboarding.id }}"/>
                <button class="btn btn-ghost" type="submit">{{ "✅" if task.is_done else "⬜" }}</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>
{% endblock %}
